#!/usr/bin/env ruby

require 'etc'

begin
  user = Etc.getpwnam("webapp")
  Process::UID.change_privilege(user.uid)
  Process::GID.change_privilege(user.gid)
rescue => e
  puts "Should be run as webapp user"
  puts "Error: #{e.message}"
  exit 1
end

require 'bundler/inline'
gemfile do
  source 'https://rubygems.org'
  gem 'daemons'
end

require 'daemons'
Daemons.run('start_foreman.rb')